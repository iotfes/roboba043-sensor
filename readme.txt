Last update: 2017/01/10
Author: Sho KANEMARU

○roboba043.rb
- Roboba043赤外線アレイセンサから8x8温度情報を取得し、Cumulocityへアップするスクリプト
- usage: 同じディレクトリにcalc_temperature.rb を配置した上で、下記コマンドを実行
  $ ruby roboba043.rb

○ calc_temperature.rb
- Roboba043赤外線アレイセンサから取得した温度情報(バイナリ)を8x8二次元配列に変換するためのライブラリ

○セットアップ方法
- シリアル通信用のrubyライブラリをインストールする。
$ sudo gem install serialport
-- 確認方法
$ gem list | grep serial
--> "serialport(1.3.1)"と表示されればOK (ver.番号は環境によって異なる)

- シリアル通信確認用ツールのインストール
$ sudo apt-get install cu
-- 確認方法
$ ls /dev
--> /ttyUSB0 が表示されることを確認(フォルダ名は環境によって異なる)
$ cu -l /dev/ttyUSB0 115200
$ w80
--> "OK"と表示されることを確認。

○実行例
- 下記のように表示されればOK
-- "r80"コマンドは失敗することがあるため、成功するまで繰り返し実行するようプログラム上で制御している。
pi@raspberrypi:~/workspace/cumulocity/sensors $ ruby roboba043.rb 
result(w80): ok
result(r80): error
result(r80): 4B,0,4A,0,50,0,4C,0,55,0,54,0,50,0,55,0,54,0,52,0,4C,0,4F,0,4F,0,53,0,4D,0,53,0,4E,0,4F,0,4C,0,50,0,53,0,50,0,53,0,4F,0,53,0,53,0,4E,0,51,0,52,0,4F,0,51,0,52,0,4F,0,51,0,54,0,4C,0,4D,0,4E,0,52,0,4F,0,51,0,54,0,50,0,53,0,53,0,52,0,4B,0,4C,0,51,0,51,0,50,0,49,0,51,0,53,0,51,0,4C,0,51,0,4C,0,4C,0,52,0,4D,0,51,0,54,0,4F,0,
["4B", "0", "4A", "0", "50", "0", "4C", "0", "55", "0", "54", "0", "50", "0", "55", "0", "54", "0", "52", "0", "4C", "0", "4F", "0", "4F", "0", "53", "0", "4D", "0", "53", "0", "4E", "0", "4F", "0", "4C", "0", "50", "0", "53", "0", "50", "0", "53", "0", "4F", "0", "53", "0", "53", "0", "4E", "0", "51", "0", "52", "0", "4F", "0", "51", "0", "52", "0", "4F", "0", "51", "0", "54", "0", "4C", "0", "4D", "0", "4E", "0", "52", "0", "4F", "0", "51", "0", "54", "0", "50", "0", "53", "0", "53", "0", "52", "0", "4B", "0", "4C", "0", "51", "0", "51", "0", "50", "0", "49", "0", "51", "0", "53", "0", "51", "0", "4C", "0", "51", "0", "4C", "0", "4C", "0", "52", "0", "4D", "0", "51", "0", "54", "0", "4F", "0", "\r\n"]
[18.75, 18.5, 20, 19, 21.25, 21, 20, 21.25, 21, 20.5, 19, 19.75, 19.75, 20.75, 19.25, 20.75, 19.5, 19.75, 19, 20, 20.75, 20, 20.75, 19.75, 20.75, 20.75, 19.5, 20.25, 20.5, 19.75, 20.25, 20.5, 19.75, 20.25, 21, 19, 19.25, 19.5, 20.5, 19.75, 20.25, 21, 20, 20.75, 20.75, 20.5, 18.75, 19, 20.25, 20.25, 20, 18.25, 20.25, 20.75, 20.25, 19, 20.25, 19, 19, 20.5, 19.25, 20.25, 21, 19.75]
------------------------
code -> 201
msg -> Created


○赤外線アレイセンサについて
- 一度の測定情報で64個(8x8)の温度データを取得できるセンサ。領域の温度を測定することが可能です。
http://moosoft.jp/index.php?option=com_content&view=article&id=105&Itemid=140
https://industrial.panasonic.com/jp/products/sensors/built-in-sensors/grid-eye

- Raspberry piと赤外線アレイセンサ間はシリアル通信を用いている。
- シリアル通信用コマンドの詳細は下記を参照。(calc_temperature.rbは下記ドキュメントのP9を実装しています。)
http://moosoft.jp/images/moosoft/grideye/grideye_manual.pdf



